<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cosmic Heart â€” For My Akka</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { background:#000005; overflow:hidden; width:100vw; height:100vh; font-family:'Georgia',serif; }
canvas { position:fixed; top:0; left:0; width:100%; height:100%; }
#overlay { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; background:radial-gradient(ellipse at center, transparent 40%, #000005 100%); z-index:1; }
#watermark { position:fixed; bottom:18px; right:24px; color:rgba(255,200,220,0.28); font-size:clamp(10px,1.2vw,13px); letter-spacing:0.18em; font-family:'Georgia',serif; font-style:italic; pointer-events:none; z-index:5; text-shadow:0 0 12px rgba(255,120,180,0.35); user-select:none; }
#sound-btn { position:fixed; top:20px; right:24px; background:rgba(255,180,210,0.12); border:1px solid rgba(255,180,210,0.3); border-radius:50px; color:rgba(255,210,230,0.85); font-size:13px; letter-spacing:0.15em; padding:8px 18px; cursor:pointer; backdrop-filter:blur(8px); transition:background 0.3s,color 0.3s; z-index:30; font-family:Georgia,serif; }
#sound-btn:hover { background:rgba(255,180,210,0.25); color:#fff; }
#petals-canvas { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:2; }
#cursor-trail-canvas { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:20; }
#shatter-canvas { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:99; }

/* Reveal button */
#reveal-btn {
  position:fixed; bottom:55px; left:50%;
  transform:translateX(-50%) translateY(20px);
  background:linear-gradient(135deg,rgba(160,0,80,0.3),rgba(60,0,100,0.35));
  border:1.5px solid rgba(255,140,190,0.5); border-radius:60px;
  color:rgba(255,220,240,0); font-family:'Georgia',serif;
  font-size:clamp(13px,1.8vw,17px); font-style:italic;
  letter-spacing:0.22em; padding:14px 40px; cursor:pointer;
  pointer-events:none; backdrop-filter:blur(12px);
  opacity:0; z-index:25;
  transition:opacity 1.4s ease, color 1.4s ease, transform 1.4s cubic-bezier(0.34,1.3,0.64,1), box-shadow 0.3s;
}
#reveal-btn.visible {
  opacity:1; color:rgba(255,220,240,0.92); pointer-events:all;
  transform:translateX(-50%) translateY(0px);
  box-shadow:0 0 30px rgba(255,100,180,0.35), 0 0 70px rgba(255,80,160,0.15);
  animation:btnPulse 2.2s ease-in-out infinite;
}
#reveal-btn:hover { background:linear-gradient(135deg,rgba(210,0,100,0.5),rgba(100,0,160,0.45)); color:#fff; transform:translateX(-50%) translateY(-3px) scale(1.05); }
@keyframes btnPulse { 0%,100%{box-shadow:0 0 25px rgba(255,100,180,0.3),0 0 55px rgba(255,80,160,0.1)} 50%{box-shadow:0 0 50px rgba(255,100,180,0.6),0 0 100px rgba(255,80,160,0.25)} }

/* Message screen */
#msg-screen {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:radial-gradient(ellipse at center,#0a0010 0%,#000005 100%);
  z-index:100; display:flex; flex-direction:column;
  align-items:center; justify-content:flex-start;
  overflow-y:auto; padding:50px 20px 60px;
  opacity:0; pointer-events:none;
  transition:opacity 0.4s ease;
}
#msg-screen.active { opacity:1; pointer-events:all; }
#msg-header {
  font-family:'Georgia',serif; font-size:clamp(18px,3.5vw,32px);
  color:rgba(255,180,210,0.95); letter-spacing:0.1em;
  margin-bottom:30px; text-align:center;
  text-shadow:0 0 30px rgba(255,100,180,0.7),0 0 60px rgba(255,80,160,0.3);
  flex-shrink:0;
}
#msg-body {
  max-width:680px; width:92%; font-family:'Georgia',serif;
  font-size:clamp(14px,2vw,18px); color:rgba(255,220,235,0.9);
  line-height:2.1; font-style:italic; text-align:center;
  text-shadow:0 0 12px rgba(255,150,200,0.25); min-height:180px;
}
#msg-cursor {
  display:inline-block; width:2px; height:1.1em;
  background:rgba(255,180,210,0.9); margin-left:2px;
  vertical-align:middle; animation:blink 0.75s step-end infinite;
  box-shadow:0 0 8px rgba(255,150,200,0.8);
}
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }
#msg-footer {
  max-width:680px; width:92%; margin-top:28px;
  font-family:'Georgia',serif; font-size:clamp(13px,1.8vw,16px);
  color:rgba(255,215,0,0); letter-spacing:0.12em;
  text-shadow:0 0 20px rgba(255,200,0,0.5);
  text-align:center; transition:color 2s ease;
}
#msg-footer.show { color:rgba(255,215,0,0.88); }
#msg-close-btn {
  margin-top:24px; flex-shrink:0;
  background:linear-gradient(135deg,rgba(160,0,80,0.3),rgba(60,0,100,0.35));
  border:1.5px solid rgba(255,140,190,0.4); border-radius:50px;
  color:rgba(255,220,240,0); font-family:'Georgia',serif;
  font-size:clamp(12px,1.5vw,15px); letter-spacing:0.2em;
  padding:11px 32px; cursor:pointer; backdrop-filter:blur(10px);
  transition:color 2s ease, background 0.3s, transform 0.3s;
}
#msg-close-btn.show { color:rgba(255,220,240,0.88); }
#msg-close-btn:hover { background:linear-gradient(135deg,rgba(210,0,100,0.5),rgba(100,0,160,0.45)); transform:scale(1.05); }

/* Quotes section after message */

  #msg-quotes-section {
    max-width:680px; width:92%; margin-top:24px;
    opacity:0; transition:opacity 1.5s ease; text-align:center; flex-shrink:0;
    padding-bottom: 40px;
  }
  #msg-quotes-section.show { opacity:1; }
  #msg-quotes-section hr { border:none; border-top:1px solid rgba(255,150,200,0.2); margin:22px auto; width:50%; }
  .q-label { font-family:'Georgia',serif; font-size:clamp(10px,1.3vw,12px); letter-spacing:0.3em; color:rgba(255,200,220,0.4); text-transform:uppercase; margin-bottom:18px; }
  .q-item { font-family:'Georgia',serif; font-size:clamp(12px,1.6vw,15px); color:rgba(255,220,235,0); font-style:italic; line-height:2.0; margin-bottom:18px; padding:0 10px; text-shadow:0 0 12px rgba(255,150,200,0.3); transition:color 1.2s ease; }
  .q-item.show { color:rgba(255,220,235,0.82); }
</style>
</head>
<body>
<canvas id="c"></canvas>
<canvas id="petals-canvas"></canvas>
<canvas id="cursor-trail-canvas"></canvas>
<canvas id="shatter-canvas"></canvas>

<div id="overlay"></div>
<button id="sound-btn">â™ª Sound ON</button>
<div id="watermark">Â© Sankeerthan K</div>
<button id="reveal-btn">âœ¦ Open My Heart âœ¦</button>

<div id="msg-screen">
  <div id="msg-header">ğŸ’Œ &nbsp; For My Dearest Akka &nbsp; ğŸ’Œ</div>
  <div id="msg-body"><span id="msg-cursor"></span></div>
  <div id="msg-footer">â€” With deep love, respect, and sincerity &nbsp;ğŸ’›&nbsp; Always your little one</div>
  <button id="msg-close-btn" onclick="closeMsgScreen()">â†© Back to the Heart</button>

</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CORE SETUP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W, H, cx, cy;
function resize() { W=canvas.width=window.innerWidth; H=canvas.height=window.innerHeight; cx=W/2; cy=H/2; }
resize(); window.addEventListener('resize', resize);

// â”€â”€ Stars â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const STAR_COUNT = 900;
const stars = Array.from({length:STAR_COUNT}, () => ({
  x:Math.random()*2000-1000, y:Math.random()*2000-1000,
  r:Math.random()*1.4, a:Math.random(), twinkle:Math.random()*Math.PI*2
}));

// â”€â”€ Particle pool â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const MAX = 18000;
const px=new Float32Array(MAX),py=new Float32Array(MAX),pvx=new Float32Array(MAX),pvy=new Float32Array(MAX);
const pa=new Float32Array(MAX),pr=new Float32Array(MAX),phue=new Float32Array(MAX),psat=new Float32Array(MAX);
const plife=new Float32Array(MAX),pmaxlife=new Float32Array(MAX),ptype=new Uint8Array(MAX);
let pcount=0;
function spawnParticle(x,y,vx,vy,hue,sat,life,radius,type){
  if(pcount>=MAX)return; const i=pcount++;
  px[i]=x;py[i]=y;pvx[i]=vx;pvy[i]=vy;phue[i]=hue;psat[i]=sat;
  pmaxlife[i]=plife[i]=life;pr[i]=radius;pa[i]=1;ptype[i]=type;
}

// â”€â”€ Heart math â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function heartPoint(t,scale){
  const x=16*Math.pow(Math.sin(t),3);
  const y=-(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
  return{x:cx+x*scale,y:cy+y*scale};
}

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let time=0, phase=0, heartBuilt=false, heartPulse=0;
let cameraZoom=1, cameraAngle=0;

// Clean heart outline targets
const HEART_POINTS=900;
const heartTargets=[];
const heartScale=Math.min(window.innerWidth,window.innerHeight)*0.038;
for(let i=0;i<HEART_POINTS;i++){
  const t=(i/HEART_POINTS)*Math.PI*2;
  const p=heartPoint(t,heartScale);
  heartTargets.push({tx:p.x,ty:p.y,t,layer:i%3});
}
let heartParts=[];

function spawnHeartParticles(){
  heartParts=heartTargets.map((ht,i)=>{
    const startAngle=ht.t;
    const startDist=Math.min(W,H)*0.5;
    return{
      x:cx+Math.cos(startAngle)*startDist,
      y:cy+Math.sin(startAngle)*startDist,
      tx:ht.tx,ty:ht.ty,t:ht.t,layer:ht.layer,
      delay:i*0.0028,progress:0,
      hue:ht.layer===0?345:ht.layer===1?200:285,
      sat:90,r:1.6
    };
  });
}

// â”€â”€ Burst â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function triggerBurst(){
  for(let i=0;i<800;i++){
    const angle=Math.random()*Math.PI*2; const speed=Math.random()*12+2;
    const hue=(Math.random()<0.5?330:180)+Math.random()*40;
    spawnParticle(cx+(Math.random()-0.5)*60,cy+(Math.random()-0.5)*60,
      Math.cos(angle)*speed,Math.sin(angle)*speed,hue,85,90+Math.random()*60,1.5+Math.random()*2.5,2);
  }
  for(let i=0;i<300;i++){
    const angle=(i/300)*Math.PI*2;
    spawnParticle(cx,cy,Math.cos(angle)*8,Math.sin(angle)*8,30+Math.random()*30,90,50,2,2);
  }
}

// â”€â”€ Waves â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let waveTimer=0;
function emitWaves(dt,ph){
  if(ph<1||ph>=3)return; waveTimer+=dt;
  const interval=ph===2?0.08:0.03;
  while(waveTimer>interval){
    waveTimer-=interval;
    for(let r=0;r<18;r++){
      const frac=r/17, yOff=(frac-0.5)*H*0.55;
      const wave=Math.sin(frac*Math.PI*3+time*4)*30;
      const speed=ph===2?2.5:7+Math.random()*2;
      spawnParticle(Math.random()*60,cy+yOff+wave+(Math.random()-0.5)*20,speed+Math.random()*1.5,(Math.random()-0.5)*0.6,320+Math.random()*40,80,120+Math.random()*60,1.2+Math.random()*1.8,0);
      spawnParticle(W-Math.random()*60,cy+yOff+wave+(Math.random()-0.5)*20,-(speed+Math.random()*1.5),(Math.random()-0.5)*0.6,175+Math.random()*50,90,120+Math.random()*60,1.2+Math.random()*1.8,1);
    }
  }
}

// â”€â”€ Nebula â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let nebulaTimer=0;
function emitNebula(dt){
  nebulaTimer+=dt; if(nebulaTimer<0.2)return; nebulaTimer=0;
  for(let i=0;i<4;i++){
    const angle=Math.random()*Math.PI*2,r=Math.random()*200+80;
    spawnParticle(cx+Math.cos(angle)*r,cy+Math.sin(angle)*r,(Math.random()-0.5)*0.3,(Math.random()-0.5)*0.3,300+Math.random()*80,60,200,8+Math.random()*12,4);
  }
}

// â”€â”€ Lightning â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let lightningTimer=0; const lightnings=[];
function spawnLightning(){
  const scale=Math.min(W,H)*0.038;
  const t=Math.random()*Math.PI*2, t2=t+(Math.random()-0.5)*1.2;
  const p=heartPoint(t,scale), p2=heartPoint(t2,scale);
  lightnings.push({x1:p.x,y1:p.y,x2:p2.x,y2:p2.y,life:15,maxLife:15,hue:180+Math.random()*40});
}

// â”€â”€ Shooting Stars â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const shootingStars=[]; let shootTimer=0;
function spawnShootingStar(){
  const side=Math.random()<0.5;
  shootingStars.push({x:side?-20:W+20,y:Math.random()*H*0.6,
    vx:side?(6+Math.random()*8):-(6+Math.random()*8),vy:(Math.random()-0.3)*4,
    len:80+Math.random()*140,life:1,hue:40+Math.random()*40});
}
function drawShootingStars(dt){
  shootTimer+=dt; if(shootTimer>1.8+Math.random()){shootTimer=0;spawnShootingStar();}
  for(let i=shootingStars.length-1;i>=0;i--){
    const s=shootingStars[i]; s.x+=s.vx; s.y+=s.vy; s.life-=dt*0.9;
    if(s.life<=0||s.x<-200||s.x>W+200){shootingStars.splice(i,1);continue;}
    const tailX=s.x-Math.sign(s.vx)*s.len;
    const grad=ctx.createLinearGradient(tailX,s.y,s.x,s.y);
    grad.addColorStop(0,'transparent');
    grad.addColorStop(0.6,`hsla(${s.hue},100%,80%,${s.life*0.4})`);
    grad.addColorStop(1,`hsla(${s.hue},100%,98%,${s.life})`);
    ctx.beginPath(); ctx.moveTo(tailX,s.y); ctx.lineTo(s.x,s.y);
    ctx.strokeStyle=grad; ctx.lineWidth=1.5+s.life; ctx.stroke();
    ctx.beginPath(); ctx.arc(s.x,s.y,2+s.life*1.5,0,Math.PI*2);
    ctx.fillStyle=`rgba(255,255,220,${s.life})`; ctx.fill();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN RENDER LOOP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let last=0;
function frame(ts){
  const dt=Math.min((ts-last)/1000,0.05); last=ts; time+=dt;

  if(phase===0&&time>1.0) phase=1;
  if(phase===1&&time>2.5) phase=2;
  if(phase===2&&time>3.8){ phase=3; triggerBurst(); setTimeout(()=>{phase=4;spawnHeartParticles();},600); }
  if(phase>=4&&!heartBuilt){
    const allDone=heartParts.every(p=>p.progress>=1);
    if(allDone){
      heartBuilt=true; phase=5;
      document.getElementById('reveal-btn').classList.add('visible');
    }
  }
  
  // Camera
  if(phase<=2) cameraZoom+=(0.85-cameraZoom)*dt*0.4;
  else if(phase===3) cameraZoom+=(1.1-cameraZoom)*dt*2;
  else cameraZoom+=(1.0-cameraZoom)*dt*0.5;
  if(phase>=5) cameraAngle+=dt*0.08;

  ctx.save();
  ctx.translate(cx,cy); ctx.scale(cameraZoom,cameraZoom); ctx.translate(-cx,-cy);
  if(phase>=5) ctx.translate(Math.cos(cameraAngle)*15,Math.sin(cameraAngle)*8);

  ctx.fillStyle='rgba(0,0,5,0.18)'; ctx.fillRect(-100,-100,W+200,H+200);

  // Stars
  const starAlpha=Math.min(1,time*0.4);
  for(const s of stars){
    s.twinkle+=dt*1.5;
    const ta=s.a*(0.6+0.4*Math.sin(s.twinkle))*starAlpha;
    ctx.beginPath(); ctx.arc(cx+s.x*(W/1800),cy+s.y*(H/1800),s.r,0,Math.PI*2);
    ctx.fillStyle=`rgba(200,210,255,${ta})`; ctx.fill();
  }

  // Space fog
  if(phase>=3){
    const fogAlpha=Math.min(0.06,(time-3.8)*0.01);
    const grad=ctx.createRadialGradient(cx,cy,0,cx,cy,Math.min(W,H)*0.5);
    grad.addColorStop(0,`rgba(255,100,160,${fogAlpha})`);
    grad.addColorStop(0.5,`rgba(100,200,255,${fogAlpha*0.5})`);
    grad.addColorStop(1,'transparent');
    ctx.fillStyle=grad; ctx.fillRect(0,0,W,H);
  }

  emitWaves(dt,phase);
  if(phase>=4) emitNebula(dt);

  // Particles
  for(let i=0;i<pcount;i++){
    plife[i]-=1;
    if(plife[i]<=0){
      px[i]=px[pcount-1];py[i]=py[pcount-1];pvx[i]=pvx[pcount-1];pvy[i]=pvy[pcount-1];
      pa[i]=pa[pcount-1];pr[i]=pr[pcount-1];phue[i]=phue[pcount-1];psat[i]=psat[pcount-1];
      plife[i]=plife[pcount-1];pmaxlife[i]=pmaxlife[pcount-1];ptype[i]=ptype[pcount-1];
      pcount--;i--;continue;
    }
    px[i]+=pvx[i];py[i]+=pvy[i];
    const drag=ptype[i]===2?0.96:ptype[i]===4?0.99:0.98;
    pvx[i]*=drag;pvy[i]*=drag;
    if(ptype[i]===2&&phase>=3){pvx[i]+=(cx-px[i])*0.0003;pvy[i]+=(cy-py[i])*0.0003;}
    const lifeRatio=plife[i]/pmaxlife[i];
    let alpha=ptype[i]===4?(lifeRatio<0.3?lifeRatio/0.3:lifeRatio)*0.08:(lifeRatio<0.3?lifeRatio/0.3*0.9:0.9);
    const sat=psat[i],lum=ptype[i]===2?65+lifeRatio*20:ptype[i]===4?35:55+lifeRatio*20;
    if(ptype[i]===4){
      const rr=pr[i]*(2-lifeRatio);
      const g=ctx.createRadialGradient(px[i],py[i],0,px[i],py[i],rr);
      g.addColorStop(0,`hsla(${phue[i]},${sat}%,${lum}%,${alpha})`);g.addColorStop(1,'transparent');
      ctx.fillStyle=g;ctx.beginPath();ctx.arc(px[i],py[i],rr,0,Math.PI*2);ctx.fill();
    }else{
      const glowR=pr[i]*3;
      const g2=ctx.createRadialGradient(px[i],py[i],0,px[i],py[i],glowR);
      g2.addColorStop(0,`hsla(${phue[i]},${sat}%,${lum+15}%,${alpha*0.6})`);g2.addColorStop(1,'transparent');
      ctx.fillStyle=g2;ctx.beginPath();ctx.arc(px[i],py[i],glowR,0,Math.PI*2);ctx.fill();
      ctx.beginPath();ctx.arc(px[i],py[i],pr[i],0,Math.PI*2);
      ctx.fillStyle=`hsla(${phue[i]},${sat}%,${Math.min(95,lum+25)}%,${alpha})`;ctx.fill();
    }
  }

  // Heart particles
  if(phase>=4){
    heartPulse+=dt*(heartBuilt?2.5:1);
    const pulseScale=heartBuilt?1+Math.sin(heartPulse)*0.04+Math.sin(heartPulse*2.3)*0.015:1;
    for(const hp of heartParts){
      if(hp.delay>0){hp.delay-=dt*60;continue;}
      hp.progress=Math.min(1,hp.progress+dt*1.8);
      const ease=hp.progress<0.5?4*hp.progress*hp.progress*hp.progress:1-Math.pow(-2*hp.progress+2,3)/2;
      const hx=hp.x+(hp.tx-hp.x)*ease, hy=hp.y+(hp.ty-hp.y)*ease;
      const ddx=hx-cx,ddy=hy-cy;
      const fx=cx+ddx*pulseScale,fy=cy+ddy*pulseScale;
      let lum=hp.layer===0?70:hp.layer===1?65:60;
      if(heartBuilt) lum+=Math.sin(heartPulse+hp.t*3)*8;
      const gr=ctx.createRadialGradient(fx,fy,0,fx,fy,hp.r*5);
      gr.addColorStop(0,`hsla(${hp.hue},${hp.sat}%,${lum}%,0.5)`);gr.addColorStop(1,'transparent');
      ctx.fillStyle=gr;ctx.beginPath();ctx.arc(fx,fy,hp.r*5,0,Math.PI*2);ctx.fill();
      ctx.beginPath();ctx.arc(fx,fy,hp.r,0,Math.PI*2);
      ctx.fillStyle=`hsla(${hp.hue},${hp.sat}%,${Math.min(95,lum+20)}%,0.95)`;ctx.fill();
    }
    if(heartBuilt){
      const ig=Math.min(W,H)*0.038;
      const innerGlow=ctx.createRadialGradient(cx,cy,0,cx,cy,ig*12);
      const gb=0.06+Math.sin(heartPulse)*0.04;
      innerGlow.addColorStop(0,`rgba(255,140,180,${gb})`);
      innerGlow.addColorStop(0.4,`rgba(255,80,120,${gb*0.5})`);
      innerGlow.addColorStop(1,'transparent');
      ctx.fillStyle=innerGlow;ctx.beginPath();ctx.arc(cx,cy,ig*12,0,Math.PI*2);ctx.fill();
      if(Math.sin(heartPulse)>0.95&&Math.sin(heartPulse-dt*2.5)<=0.95){
        for(let i=0;i<60;i++){
          const ang=(i/60)*Math.PI*2,sp=2+Math.random()*3;
          spawnParticle(cx,cy,Math.cos(ang)*sp,Math.sin(ang)*sp,330+Math.random()*40,85,50+Math.random()*30,1.5,2);
        }
      }
      lightningTimer+=dt;
      if(lightningTimer>0.12){lightningTimer=0;spawnLightning();}
      for(let li=lightnings.length-1;li>=0;li--){
        const l=lightnings[li];l.life-=1;
        if(l.life<=0){lightnings.splice(li,1);continue;}
        const lr=l.life/l.maxLife;
        const mx=(l.x1+l.x2)/2+(Math.random()-0.5)*30;
        const my=(l.y1+l.y2)/2+(Math.random()-0.5)*30;
        ctx.beginPath();ctx.moveTo(l.x1,l.y1);ctx.quadraticCurveTo(mx,my,l.x2,l.y2);
        ctx.strokeStyle=`hsla(${l.hue},90%,75%,${lr*0.8})`;ctx.lineWidth=lr*1.5;
        ctx.shadowColor=`hsl(${l.hue},100%,80%)`;ctx.shadowBlur=8;ctx.stroke();ctx.shadowBlur=0;
      }
    }
  }

  // Collision flash
  if(phase===3){
    const flashAlpha=Math.max(0,0.9-(time-3.8)*2.5);
    if(flashAlpha>0){
      const fg=ctx.createRadialGradient(cx,cy,0,cx,cy,Math.min(W,H)*0.5);
      fg.addColorStop(0,`rgba(255,220,240,${flashAlpha})`);
      fg.addColorStop(0.3,`rgba(255,100,180,${flashAlpha*0.5})`);
      fg.addColorStop(1,'transparent');
      ctx.fillStyle=fg;ctx.fillRect(0,0,W,H);
    }
  }

  drawShootingStars(dt);

  const vig=ctx.createRadialGradient(cx,cy,Math.min(W,H)*0.3,cx,cy,Math.min(W,H)*0.85);
  vig.addColorStop(0,'transparent');vig.addColorStop(1,'rgba(0,0,5,0.55)');
  ctx.fillStyle=vig;ctx.fillRect(0,0,W,H);
  ctx.restore();

  if(Math.random()<0.3){
    ctx.beginPath();ctx.arc(Math.random()*W,Math.random()*H,Math.random()*1.2,0,Math.PI*2);
    ctx.fillStyle=`rgba(255,240,255,${Math.random()*0.3})`;ctx.fill();
  }
  requestAnimationFrame(frame);
}
requestAnimationFrame(ts=>{last=ts;frame(ts);});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ROSE PETALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const petalCanvas=document.getElementById('petals-canvas');
const pc=petalCanvas.getContext('2d');
function resizePetals(){petalCanvas.width=window.innerWidth;petalCanvas.height=window.innerHeight;}
resizePetals(); window.addEventListener('resize',resizePetals);
const petals=[]; const PETAL_COUNT=38;
function createPetal(){return{x:Math.random()*petalCanvas.width,y:-30-Math.random()*100,size:7+Math.random()*11,speedY:0.6+Math.random()*1.2,speedX:(Math.random()-0.5)*1.2,rotation:Math.random()*Math.PI*2,rotSpeed:(Math.random()-0.5)*0.04,sway:Math.random()*Math.PI*2,swaySpeed:0.01+Math.random()*0.02,swayAmt:20+Math.random()*30,alpha:0.5+Math.random()*0.5,hue:340+Math.random()*30};}
for(let i=0;i<PETAL_COUNT;i++){const p=createPetal();p.y=Math.random()*petalCanvas.height;petals.push(p);}
function updatePetals(dt){
  pc.clearRect(0,0,petalCanvas.width,petalCanvas.height);
  for(const p of petals){
    p.sway+=p.swaySpeed;p.x+=p.speedX+Math.sin(p.sway)*p.swayAmt*dt;p.y+=p.speedY;p.rotation+=p.rotSpeed;
    if(p.y>petalCanvas.height+40)Object.assign(p,createPetal());
    pc.save();pc.translate(p.x,p.y);pc.rotate(p.rotation);
    pc.globalAlpha=p.alpha*(phase>=3?1:0);
    pc.beginPath();pc.moveTo(0,0);
    pc.bezierCurveTo(p.size*0.5,-p.size*0.8,p.size*1.2,-p.size*0.5,p.size,0);
    pc.bezierCurveTo(p.size*1.2,p.size*0.5,p.size*0.5,p.size*0.8,0,0);
    const pg=pc.createRadialGradient(p.size*0.4,0,0,p.size*0.4,0,p.size);
    pg.addColorStop(0,`hsla(${p.hue},90%,88%,1)`);pg.addColorStop(0.5,`hsla(${p.hue},80%,75%,0.9)`);pg.addColorStop(1,`hsla(${p.hue+10},70%,60%,0.6)`);
    pc.fillStyle=pg;pc.shadowColor=`hsla(${p.hue},80%,70%,0.5)`;pc.shadowBlur=8;pc.fill();pc.restore();
  }
}
let petalLast=0;
(function petalLoop(ts){const dt=Math.min((ts-petalLast)/1000,0.05);petalLast=ts;updatePetals(dt);requestAnimationFrame(petalLoop);})(0);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CURSOR TRAIL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const trailCanvas=document.getElementById('cursor-trail-canvas');
const tc=trailCanvas.getContext('2d');
function resizeTrail(){trailCanvas.width=window.innerWidth;trailCanvas.height=window.innerHeight;}
resizeTrail(); window.addEventListener('resize',resizeTrail);
const trailParticles=[];
window.addEventListener('mousemove',e=>{
  for(let i=0;i<4;i++){
    const angle=Math.random()*Math.PI*2,speed=Math.random()*2.5+0.5;
    trailParticles.push({x:e.clientX+(Math.random()-0.5)*8,y:e.clientY+(Math.random()-0.5)*8,vx:Math.cos(angle)*speed,vy:Math.sin(angle)*speed-1.2,life:1,decay:0.025+Math.random()*0.03,r:1.5+Math.random()*3,hue:Math.random()<0.5?330+Math.random()*40:40+Math.random()*20,star:Math.random()<0.4});
  }
});
function updateTrail(dt){
  tc.clearRect(0,0,trailCanvas.width,trailCanvas.height);
  for(let i=trailParticles.length-1;i>=0;i--){
    const p=trailParticles[i];p.x+=p.vx;p.y+=p.vy;p.vy+=0.06;p.life-=p.decay;
    if(p.life<=0){trailParticles.splice(i,1);continue;}
    if(p.star){
      tc.save();tc.translate(p.x,p.y);tc.rotate(Date.now()*0.003);
      tc.beginPath();
      for(let s=0;s<5;s++){const oa=(s*4*Math.PI)/5-Math.PI/2,ia=oa+(2*Math.PI)/10;
        s===0?tc.moveTo(Math.cos(oa)*p.r*p.life,Math.sin(oa)*p.r*p.life):tc.lineTo(Math.cos(oa)*p.r*p.life,Math.sin(oa)*p.r*p.life);
        tc.lineTo(Math.cos(ia)*p.r*p.life*0.45,Math.sin(ia)*p.r*p.life*0.45);}
      tc.closePath();tc.fillStyle=`hsla(${p.hue},100%,80%,${p.life})`;tc.fill();tc.restore();
    }else{
      const g=tc.createRadialGradient(p.x,p.y,0,p.x,p.y,p.r*2.5);
      g.addColorStop(0,`hsla(${p.hue},100%,90%,${p.life})`);g.addColorStop(1,'transparent');
      tc.fillStyle=g;tc.beginPath();tc.arc(p.x,p.y,p.r*2.5,0,Math.PI*2);tc.fill();
    }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BUTTERFLIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const butterflyCanvas=document.createElement('canvas');
butterflyCanvas.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:3;';
document.body.appendChild(butterflyCanvas);
const bc=butterflyCanvas.getContext('2d');
function resizeBfly(){butterflyCanvas.width=window.innerWidth;butterflyCanvas.height=window.innerHeight;}
resizeBfly(); window.addEventListener('resize',resizeBfly);
const butterflies=[];
function createButterfly(){const fromLeft=Math.random()<0.5;return{x:fromLeft?-60:window.innerWidth+60,y:80+Math.random()*window.innerHeight*0.7,vx:fromLeft?1.2+Math.random()*1.5:-(1.2+Math.random()*1.5),vy:(Math.random()-0.5)*0.8,wingPhase:Math.random()*Math.PI*2,wingSpeed:0.08+Math.random()*0.07,size:14+Math.random()*16,hue:[330,280,40,200][Math.floor(Math.random()*4)],alpha:0.7+Math.random()*0.3,wanderAngle:0,wanderSpeed:0.02+Math.random()*0.02};}
for(let i=0;i<5;i++){const b=createButterfly();b.x=Math.random()*window.innerWidth;b.y=80+Math.random()*window.innerHeight*0.7;butterflies.push(b);}
function drawButterfly(b){
  bc.save();bc.translate(b.x,b.y);
  const wingW=b.size*Math.abs(Math.sin(b.wingPhase));
  const wg=side=>{const g=bc.createRadialGradient(side*wingW*0.3,-b.size*0.2,0,side*wingW*0.5,0,b.size);g.addColorStop(0,`hsla(${b.hue},90%,85%,${b.alpha})`);g.addColorStop(0.5,`hsla(${b.hue+15},80%,70%,${b.alpha*0.8})`);g.addColorStop(1,`hsla(${b.hue+30},70%,55%,${b.alpha*0.3})`);return g;};
  bc.shadowColor=`hsla(${b.hue},90%,80%,0.6)`;bc.shadowBlur=12;
  [-1,1].forEach(side=>{bc.beginPath();bc.moveTo(0,0);bc.bezierCurveTo(side*wingW*0.3,-b.size*0.8,side*wingW*1.1,-b.size*0.5,side*wingW,0);bc.bezierCurveTo(side*wingW*0.9,b.size*0.3,side*wingW*0.2,b.size*0.1,0,0);bc.fillStyle=wg(side);bc.fill();});
  [-1,1].forEach(side=>{bc.beginPath();bc.moveTo(0,0);bc.bezierCurveTo(side*wingW*0.8,b.size*0.2,side*wingW*0.9,b.size*0.9,side*wingW*0.4,b.size*0.8);bc.bezierCurveTo(side*wingW*0.1,b.size*0.9,0,b.size*0.5,0,0);bc.fillStyle=wg(side);bc.fill();});
  bc.beginPath();bc.ellipse(0,0,1.5,b.size*0.45,0,0,Math.PI*2);bc.fillStyle=`hsla(${b.hue},60%,30%,0.9)`;bc.fill();
  bc.shadowBlur=0;bc.restore();
}
let bflySpawnT=0;
function updateButterflies(dt){
  bc.clearRect(0,0,butterflyCanvas.width,butterflyCanvas.height);
  bflySpawnT+=dt;if(bflySpawnT>4+Math.random()*3&&butterflies.length<9){bflySpawnT=0;butterflies.push(createButterfly());}
  for(let i=butterflies.length-1;i>=0;i--){
    const b=butterflies[i];b.wingPhase+=b.wingSpeed;b.wanderAngle+=(Math.random()-0.5)*b.wanderSpeed;
    b.vx+=Math.cos(b.wanderAngle)*0.04;b.vy+=Math.sin(b.wanderAngle)*0.04;b.vx*=0.98;b.vy*=0.98;
    b.x+=b.vx;b.y+=b.vy;if(b.y<40)b.vy+=0.2;if(b.y>butterflyCanvas.height-40)b.vy-=0.2;
    if(b.x<-100||b.x>butterflyCanvas.width+100){butterflies.splice(i,1);continue;}
    drawButterfly(b);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFETTI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const confCanvas=document.createElement('canvas');
confCanvas.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:7;';
document.body.appendChild(confCanvas);
const cc=confCanvas.getContext('2d');
function resizeConf(){confCanvas.width=window.innerWidth;confCanvas.height=window.innerHeight;}
resizeConf(); window.addEventListener('resize',resizeConf);
const confetti=[];
const confColors=['#ff6eb0','#ffd700','#ff4dd2','#00e5ff','#ff8c42','#c084fc','#ffd6e8','#fffacd'];
function spawnConfetti(count){
  for(let i=0;i<count;i++){confetti.push({x:Math.random()*confCanvas.width,y:-10,vx:(Math.random()-0.5)*6,vy:1+Math.random()*3,rot:Math.random()*Math.PI*2,rotV:(Math.random()-0.5)*0.15,w:6+Math.random()*10,h:4+Math.random()*6,color:confColors[Math.floor(Math.random()*confColors.length)],life:1,decay:0.004+Math.random()*0.006,shape:Math.random()<0.4?'circle':Math.random()<0.6?'rect':'star'});}
}
let confFinale=false;
function checkConfetti(){
  if(heartBuilt&&!confFinale){confFinale=true;spawnConfetti(180);setTimeout(()=>spawnConfetti(150),600);setTimeout(()=>spawnConfetti(120),1400);}
}
function updateConfetti(dt){
  cc.clearRect(0,0,confCanvas.width,confCanvas.height);
  for(let i=confetti.length-1;i>=0;i--){
    const c=confetti[i];c.x+=c.vx;c.y+=c.vy;c.vy+=0.12;c.vx*=0.99;c.rot+=c.rotV;c.life-=c.decay;
    if(c.life<=0||c.y>confCanvas.height+20){confetti.splice(i,1);continue;}
    cc.save();cc.translate(c.x,c.y);cc.rotate(c.rot);cc.globalAlpha=Math.min(1,c.life*1.5);
    cc.fillStyle=c.color;cc.shadowColor=c.color;cc.shadowBlur=4;
    if(c.shape==='circle'){cc.beginPath();cc.arc(0,0,c.w/2,0,Math.PI*2);cc.fill();}
    else if(c.shape==='rect'){cc.fillRect(-c.w/2,-c.h/2,c.w,c.h);}
    else{cc.beginPath();for(let s=0;s<5;s++){const a=(s*4*Math.PI)/5-Math.PI/2,ia=a+Math.PI/5;s===0?cc.moveTo(Math.cos(a)*c.w/2,Math.sin(a)*c.w/2):cc.lineTo(Math.cos(a)*c.w/2,Math.sin(a)*c.w/2);cc.lineTo(Math.cos(ia)*c.w/4,Math.sin(ia)*c.w/4);}cc.closePath();cc.fill();}
    cc.restore();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUDIO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let audioCtx=null,soundOn=false,heartbeatInterval=null;
function initAudio(){audioCtx=new(window.AudioContext||window.webkitAudioContext)();}
function playHeartbeat(){
  if(!audioCtx||!soundOn)return;
  [0,0.25].forEach((delay,i)=>{
    const osc=audioCtx.createOscillator(),gain=audioCtx.createGain(),filter=audioCtx.createBiquadFilter();
    filter.type='lowpass';filter.frequency.value=120;
    osc.connect(filter);filter.connect(gain);gain.connect(audioCtx.destination);
    osc.type='sine';osc.frequency.setValueAtTime(i===0?58:48,audioCtx.currentTime+delay);
    osc.frequency.exponentialRampToValueAtTime(28,audioCtx.currentTime+delay+0.18);
    gain.gain.setValueAtTime(0,audioCtx.currentTime+delay);
    gain.gain.linearRampToValueAtTime(0.55,audioCtx.currentTime+delay+0.02);
    gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+delay+0.22);
    osc.start(audioCtx.currentTime+delay);osc.stop(audioCtx.currentTime+delay+0.25);
  });
}
function startHeartbeat(){playHeartbeat();heartbeatInterval=setInterval(playHeartbeat,900);}
function stopHeartbeat(){clearInterval(heartbeatInterval);}
document.getElementById('sound-btn').addEventListener('click',()=>{
  if(!audioCtx)initAudio();soundOn=!soundOn;
  document.getElementById('sound-btn').textContent=soundOn?'â™ª Sound OFF':'â™ª Sound ON';
  if(soundOn)startHeartbeat();else stopHeartbeat();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHATTER + TYPEWRITER REVEAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const shatterCanvas=document.getElementById('shatter-canvas');
const sc=shatterCanvas.getContext('2d');
function resizeShatter(){shatterCanvas.width=window.innerWidth;shatterCanvas.height=window.innerHeight;}
resizeShatter(); window.addEventListener('resize',resizeShatter);

let shatterPieces=[],shatterActive=false,heartBroken=false;

function triggerHeartShatter(){
  if(heartBroken)return;
  heartBroken=true; shatterActive=true;

  // Hide reveal button
  const btn=document.getElementById('reveal-btn');
  btn.classList.remove('visible'); btn.style.pointerEvents='none';

  // Shatter the heart outline
  const scale=Math.min(W,H)*0.038;
  for(let i=0;i<160;i++){
    const t=Math.random()*Math.PI*2;
    const p=heartPoint(t,scale);
    const ang=Math.atan2(p.y-cy,p.x-cx);
    const speed=3+Math.random()*10;
    const hue=Math.random()<0.6?330+Math.random()*40:280+Math.random()*50;
    shatterPieces.push({x:p.x,y:p.y,vx:Math.cos(ang)*speed*(0.6+Math.random()),vy:Math.sin(ang)*speed*(0.6+Math.random())-2,rot:Math.random()*Math.PI*2,rotV:(Math.random()-0.5)*0.22,size:5+Math.random()*14,hue,life:1,decay:0.007+Math.random()*0.01,shape:Math.floor(Math.random()*3)});
  }
  heartParts=[];

  // Show message screen immediately
  showMessageScreen();
}

function drawShatter(dt){
  sc.clearRect(0,0,shatterCanvas.width,shatterCanvas.height);
  for(let i=shatterPieces.length-1;i>=0;i--){
    const p=shatterPieces[i];p.x+=p.vx;p.y+=p.vy;p.vy+=0.18;p.vx*=0.97;p.vy*=0.97;p.rot+=p.rotV;p.life-=p.decay;
    if(p.life<=0){shatterPieces.splice(i,1);continue;}
    sc.save();sc.translate(p.x,p.y);sc.rotate(p.rot);sc.globalAlpha=p.life;
    sc.shadowColor=`hsl(${p.hue},100%,75%)`;sc.shadowBlur=14;sc.fillStyle=`hsl(${p.hue},90%,72%)`;
    const s=p.size*p.life;
    if(p.shape===0){sc.beginPath();sc.moveTo(0,-s);sc.lineTo(s*0.65,s*0.5);sc.lineTo(-s*0.65,s*0.5);sc.closePath();sc.fill();}
    else if(p.shape===1){sc.beginPath();sc.moveTo(0,-s);sc.lineTo(s*0.45,0);sc.lineTo(0,s);sc.lineTo(-s*0.45,0);sc.closePath();sc.fill();}
    else{sc.strokeStyle=`hsl(${p.hue},100%,82%)`;sc.lineWidth=2;sc.beginPath();sc.moveTo(-s,0);sc.lineTo(s,0);sc.stroke();}
    sc.shadowBlur=0;sc.restore();
  }
}

// Typewriter message
const MESSAGE_LINES=[
  "Akka ğŸ’›",
  "",
  "I've been holding these words in my heart for a long time,",
  "and today I just want to say everything honestly.",
  "",
  "From the day you became part of my life, something changed in me.",
  "The way you speak, the way you guide,",
  "the calm strength in your voice,",
  "and the care hidden even in your strictness â€”",
  "all of it has shaped me more than you will ever realize.",
  "",
  "You may think you are just being normalâ€¦",
  "but for me, you are someone very special.",
  "",
  "You are not just someone I call \"Akka.\"",
  "You are truly my elder sister in every sense â€”",
  "in guidance, in protection, in concern,",
  "and in the silent support you give.",
  "",
  "When you advise me, I listen seriously",
  "because your words matter to me.",
  "When you appreciate me, even a little,",
  "it motivates me for days.",
  "When you believe in me,",
  "it gives me strength to believe in myself.",
  "",
  "Sometimes I may not express how much you mean to me.",
  "I may act normal or quiet.",
  "But inside, I value you more than I can show.",
  "Your presence makes me feel safe.",
  "Your attention makes me happy.",
  "Even small conversations with you",
  "can change my whole day.",
  "",
  "That is why when you ignore me or become distant,",
  "even slightly, it hurts deeply.",
  "It's not ego or anger â€”",
  "it's just the pain of feeling far from someone",
  "who is so important to me.",
  "",
  "When you go silent, my heart feels heavy.",
  "I start wondering if I did something wrong,",
  "or if I'm no longer important to you.",
  "And that feeling is very difficult for me to handle.",
  "",
  "I don't expect big things from you.",
  "I don't expect constant attention.",
  "I just want to feel that I still matter to you.",
  "That I am not someone you will forget with time.",
  "",
  "No matter how busy life becomes,",
  "I hope you will always remember",
  "that there is someone here",
  "who truly respects you, looks up to you,",
  "and cares about you deeply.",
  "",
  "If I ever make mistakes, please correct me.",
  "If I say something wrong, please guide me.",
  "I am ready to improve. I am ready to learn.",
  "But please don't ignore me.",
  "Your silence hurts much more",
  "than any scolding ever could.",
  "",
  "I promise I will always respect you,",
  "always be grateful for you,",
  "and always try to become someone",
  "you can be proud of.",
  "",
  "The place you hold in my life is permanent.",
  "It will never change.",
  "",
  "Please never forget me.",
  "Please never push me away.",
  "Keep me somewhere in your heart,",
  "just like I keep you in mine every day.",
  "",
  "With deep love, respect, and sincerity,",
  "Always your little one ğŸ’›"
];

let typeTimer=null,typeActive=false;

function showMessageScreen(){
  document.getElementById('msg-screen').classList.add('active');
  startTyping();
}

function startTyping(){
  typeActive=true;
  const body=document.getElementById('msg-body');
  body.innerHTML='<span id="msg-cursor"></span>';
  let lineIdx=0,charIdx=0;
  function typeChar(){
    if(!typeActive)return;
    const cursor=document.getElementById('msg-cursor');
    if(!cursor)return;
    if(lineIdx>=MESSAGE_LINES.length){
      cursor.style.display='none';
      setTimeout(()=>{
        document.getElementById('msg-footer').classList.add('show');
        document.getElementById('msg-close-btn').classList.add('show');
        // Cascade quotes one by one
        const qs=document.getElementById('msg-quotes-section');
        if(qs){
          setTimeout(()=>{
            qs.classList.add('show');
            [0,1,2,3,4,5,6,7,8,9].forEach((qi)=>{
              setTimeout(()=>{
                const qel=document.getElementById('q'+qi);
                if(qel) qel.classList.add('show');
              }, qi*900);
            });
          }, 600);
        }

      },500);
      return;
    }
    const line=MESSAGE_LINES[lineIdx];
    if(line===''){cursor.insertAdjacentHTML('beforebegin','<br>');lineIdx++;charIdx=0;typeTimer=setTimeout(typeChar,280);return;}
    if(charIdx<line.length){
      const ch=line[charIdx];cursor.insertAdjacentText('beforebegin',ch);charIdx++;
      const delay=['.','!','?'].includes(ch)?200:ch===','?120:40;
      typeTimer=setTimeout(typeChar,delay);
    }else{cursor.insertAdjacentHTML('beforebegin','<br>');lineIdx++;charIdx=0;typeTimer=setTimeout(typeChar,260);}
  }
  typeChar();
}

function closeMsgScreen(){
  typeActive=false;clearTimeout(typeTimer);
  document.getElementById('msg-screen').classList.remove('active');
  setTimeout(()=>{
    document.getElementById('msg-body').innerHTML='<span id="msg-cursor"></span>';
    const qs=document.getElementById('msg-quotes-section');
    if(qs){ qs.classList.remove('show'); for(let qi=0;qi<10;qi++){ const qel=document.getElementById('q'+qi); if(qel) qel.classList.remove('show'); } }
    document.getElementById('msg-footer').classList.remove('show');
    document.getElementById('msg-close-btn').classList.remove('show');

  },1000);
  heartBroken=false;heartBuilt=false;shatterPieces=[];heartParts=[];
  spawnHeartParticles();
  setTimeout(()=>{
    heartBuilt=true;
    const btn=document.getElementById('reveal-btn');
    btn.style.pointerEvents='';
    btn.classList.add('visible');
  },3200);
}

// Attach reveal button
document.getElementById('reveal-btn').addEventListener('click',triggerHeartShatter);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UNIFIED LOOPS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let extraLast=0;
(function extraLoop(ts){
  const dt=Math.min((ts-extraLast)/1000,0.05);extraLast=ts;
  updateTrail(dt);updateButterflies(dt);updateConfetti(dt);
  drawShatter(dt);checkConfetti();
  requestAnimationFrame(extraLoop);
})(0);
</script>
</body>
</html>
